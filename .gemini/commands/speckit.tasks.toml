description = "사용 가능한 디자인 산출물을 바탕으로 실행 가능하고 의존성 순서가 지정된 기능용 tasks.md를 생성합니다."

prompt = """
---
description: 사용 가능한 디자인 산출물을 바탕으로 실행 가능하고 의존성 순서가 지정된 기능용 tasks.md를 생성합니다.
handoffs: 
  - label: 일관성 분석
    agent: speckit.analyze
    prompt: 프로젝트의 일관성 분석을 실행합니다.
    send: true
  - label: 프로젝트 구현
    agent: speckit.implement
    prompt: 단계별로 구현을 시작합니다.
    send: true
---

## 사용자 입력

```text
$ARGUMENTS
```

진행하기 전에 사용자 입력이 비어 있지 않다면 이를 **반드시** 고려해야 합니다.

## 개요

1. **설정**: 저장소 루트에서 다음 스크립트를 실행하고 FEATURE_DIR 및 AVAILABLE_DOCS 목록에 대한 JSON을 구문 분석합니다.
   - **Windows**: `.specify/scripts/powershell/check-prerequisites.ps1 --json`
   - **그 외**: `.specify/scripts/bash/check-prerequisites.sh --json`
   - 모든 경로는 절대 경로여야 합니다. "I'm Groot"와 같이 인자에 작은따옴표가 포함된 경우 이스케이프 구문을 사용하십시오: 예: 'I'\\''m Groot' (또는 가능하면 큰따옴표: "I'm Groot").

2. **디자인 문서 로드**: FEATURE_DIR에서 다음을 읽습니다:
   - **필수**: plan.md (기술 스택, 라이브러리, 구조), spec.md (우선순위가 지정된 사용자 스토리)
   - **선택**: data-model.md (엔티티), contracts/ (API 엔드포인트), research.md (결정 사항), quickstart.md (테스트 시나리오)
   - 참고: 모든 프로젝트에 모든 문서가 있는 것은 아닙니다. 사용 가능한 문서를 바탕으로 작업을 생성하십시오.

3. **작업 생성 워크플로우 실행**:
   - plan.md를 로드하여 기술 스택, 라이브러리, 프로젝트 구조를 추출합니다.
   - spec.md를 로드하여 사용자 스토리와 우선순위(P1, P2, P3 등)를 추출합니다.
   - data-model.md가 있는 경우: 엔티티를 추출하고 사용자 스토리에 매핑합니다.
   - contracts/가 있는 경우: 엔드포인트를 사용자 스토리에 매핑합니다.
   - research.md가 있는 경우: 설정 작업을 위한 결정 사항을 추출합니다.
   - 사용자 스토리별로 구성된 작업을 생성합니다 (아래 '작업 생성 규칙' 참조).
   - 사용자 스토리 완료 순서를 보여주는 의존성 그래프를 생성합니다.
   - 사용자 스토리별 병렬 실행 예시를 작성합니다.
   - 작업 완전성을 검증합니다 (각 사용자 스토리에 필요한 모든 작업이 있고 독립적으로 테스트 가능한지 확인).

4. **tasks.md 생성**: `.specify/templates/tasks-template.md`를 구조로 사용하고 다음을 채웁니다:
   - plan.md의 정확한 기능 이름
   - 1단계: 설정 작업 (프로젝트 초기화)
   - 2단계: 기반 구축 작업 (모든 사용자 스토리에 대한 차단 선행 조건)
   - 3단계 이상: 사용자 스토리당 한 단계 (spec.md의 우선순위 순서)
   - 각 단계에는 다음이 포함됩니다: 스토리 목표, 독립 테스트 기준, 테스트(요청된 경우), 구현 작업
   - 최종 단계: 다듬기 및 교차 사안
   - 모든 작업은 엄격한 체크리스트 형식을 따라야 합니다 (아래 '작업 생성 규칙' 참조).
   - 각 작업에 대한 명확한 파일 경로
   - 스토리 완료 순서를 보여주는 의존성 섹션
   - 스토리별 병렬 실행 예시
   - 구현 전략 섹션 (MVP 우선, 점진적 인도)

5. **보고**: 생성된 tasks.md의 경로와 요약을 출력합니다:
   - 총 작업 수
   - 사용자 스토리별 작업 수
   - 식별된 병렬 작업 기회
   - 각 스토리에 대한 독립 테스트 기준
   - 제안된 MVP 범위 (일반적으로 사용자 스토리 1)
   - 형식 검증: 모든 작업이 체크리스트 형식(체크박스, ID, 라벨, 파일 경로)을 따르는지 확인합니다.

작업 생성을 위한 컨텍스트: {{args}}

tasks.md는 즉시 실행 가능해야 합니다. 각 작업은 추가적인 컨텍스트 없이도 LLM이 완료할 수 있을 만큼 구체적이어야 합니다.

## 작업 생성 규칙

**중요**: 독립적인 구현과 테스트가 가능하도록 작업은 반드시 사용자 스토리별로 구성되어야 합니다.

**테스트는 선택 사항입니다**: 기능 사양에서 명시적으로 요청하거나 사용자가 TDD 방식을 요청한 경우에만 테스트 작업을 생성하십시오.

### 체크리스트 형식 (필수)

모든 작업은 반드시 다음 형식을 엄격히 따라야 합니다:

```text
- [ ] [TaskID] [P?] [Story?] 파일 경로를 포함한 설명
```

**형식 구성 요소**:

1. **체크박스**: 항상 `- [ ]`로 시작합니다 (마크다운 체크박스).
2. **작업 ID**: 실행 순서에 따른 순차적 번호 (T001, T002, T003...).
3. **[P] 마커**: 작업이 병렬화 가능한 경우에만 포함합니다 (서로 다른 파일, 미완료 작업에 대한 의존성 없음).
4. **[Story] 라벨**: 사용자 스토리 단계 작업에만 필수입니다.
   - 형식: [US1], [US2], [US3] 등 (spec.md의 사용자 스토리에 매핑).
   - 설정 단계: 스토리 라벨 없음.
   - 기반 구축 단계: 스토리 라벨 없음.
   - 사용자 스토리 단계: 반드시 스토리 라벨 포함.
   - 다듬기 단계: 스토리 라벨 없음.
5. **설명**: 정확한 파일 경로를 포함한 명확한 액션.

**예시**:

- ✅ 올바름: `- [ ] T001 구현 계획에 따라 프로젝트 구조 생성`
- ✅ 올바름: `- [ ] T005 [P] src/middleware/auth.py에 인증 미들웨어 구현`
- ✅ 올바름: `- [ ] T012 [P] [US1] src/models/user.py에 User 모델 생성`
- ✅ 올바름: `- [ ] T014 [US1] src/services/user_service.py에 UserService 구현`
- ❌ 틀림: `- [ ] User 모델 생성` (ID 및 스토리 라벨 누락)
- ❌ 틀림: `T001 [US1] 모델 생성` (체크박스 누락)
- ❌ 틀림: `- [ ] [US1] User 모델 생성` (작업 ID 누락)
- ❌ 틀림: `- [ ] T001 [US1] 모델 생성` (파일 경로 누락)

### 작업 구성

1. **사용자 스토리(spec.md) 기반** - 기본 구성:
   - 각 사용자 스토리(P1, P2, P3...)는 자체 단계를 가집니다.
   - 모든 관련 컴포넌트를 해당 스토리에 매핑합니다:
     - 해당 스토리에 필요한 모델
     - 해당 스토리에 필요한 서비스
     - 해당 스토리에 필요한 엔드포인트/UI
     - 테스트가 요청된 경우: 해당 스토리에 특화된 테스트
   - 스토리 의존성을 표시합니다 (대부분의 스토리는 독립적이어야 함).

2. **계약(Contracts) 기반**:
   - 각 계약/엔드포인트 → 서비스를 제공하는 사용자 스토리에 매핑합니다.
   - 테스트가 요청된 경우: 각 계약 → 해당 스토리 단계에서 구현 전 계약 테스트 작업 [P].

3. **데이터 모델 기반**:
   - 각 엔티티를 필요로 하는 사용자 스토리에 매핑합니다.
   - 엔티티가 여러 스토리에서 사용되는 경우: 가장 이른 스토리 또는 설정 단계에 둡니다.
   - 관계 → 적절한 스토리 단계의 서비스 레이어 작업.

4. **설정/인프라 기반**:
   - 공유 인프라 → 설정 단계 (1단계)
   - 기반/차단 작업 → 기반 구축 단계 (2단계)
   - 스토리별 설정 → 해당 스토리 단계 내.

### 단계 구조

- **1단계**: 설정 (프로젝트 초기화)
- **2단계**: 기반 구축 (차단 선행 조건 - 사용자 스토리 전에 반드시 완료)
- **3단계 이상**: 우선순위 순서에 따른 사용자 스토리 (P1, P2, P3...)
  - 각 스토리 내: 테스트(요청된 경우) → 모델 → 서비스 → 엔드포인트 → 통합
  - 각 단계는 완전하고 독립적으로 테스트 가능한 증분이어야 합니다.
- **최종 단계**: 다듬기 및 교차 사안
"""
