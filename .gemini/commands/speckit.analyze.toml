description = "기능 구현 후 spec.md, plan.md, tasks.md 간의 비파괴적 교차 산출물 일관성 및 품질 분석을 수행합니다."

prompt = """
---
description: 작업 생성 후 spec.md, plan.md, tasks.md 간의 비파괴적 교차 산출물 일관성 및 품질 분석을 수행합니다.
---

## 사용자 입력

```text
$ARGUMENTS
```

진행하기 전에 사용자 입력이 비어 있지 않다면 이를 **반드시** 고려해야 합니다.

## 목표

구현 전 세 가지 핵심 산출물(`spec.md`, `plan.md`, `tasks.md`) 전반에서 불일치, 중복, 모호성 및 미비한 항목을 식별합니다. 이 명령은 `/speckit.tasks`가 성공적으로 완료되어 `tasks.md`가 생성된 후에만 실행해야 합니다.

## 운영 제약 사항

**엄격한 읽기 전용**: 어떠한 파일도 수정하지 마십시오. 구조화된 분석 보고서를 출력하십시오. 선택적인 개선 계획을 제안하십시오(사용자가 수동으로 후속 편집 명령을 실행하기 전에 명시적으로 승인해야 함).

**헌법 권위**: 프로젝트 헌법(`.specify/memory/constitution.md`)은 이 분석 범위 내에서 **협상 불가능**합니다. 헌법 충돌은 자동으로 '심각(CRITICAL)'으로 간주되며 사양, 계획 또는 작업의 조정이 필요합니다. 원칙을 희석하거나 재해석하거나 묵인해서는 안 됩니다. 원칙 자체를 변경해야 하는 경우 `/speckit.analyze` 외부에서 별도의 명시적인 헌법 업데이트를 통해 수행해야 합니다.

## 실행 단계

### 1. 분석 컨텍스트 초기화

저장소 루트에서 다음 스크립트를 한 번 실행하고 FEATURE_DIR 및 AVAILABLE_DOCS에 대한 JSON 응답을 구문 분석합니다.

- **Windows**: `.specify/scripts/powershell/check-prerequisites.ps1 --json --require-tasks --include-tasks`
- **그 외**: `.specify/scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks`

절대 경로를 도출합니다:
- SPEC = FEATURE_DIR/spec.md
- PLAN = FEATURE_DIR/plan.md
- TASKS = FEATURE_DIR/tasks.md

필요한 파일이 누락된 경우 에러 메시지와 함께 중단하십시오(사용자에게 누락된 필수 명령을 실행하도록 안내).
"I'm Groot"와 같이 인자에 작은따옴표가 포함된 경우 이스케이프 구문을 사용하십시오: 예: 'I'\\''m Groot' (또는 가능하면 큰따옴표: "I'm Groot").

### 2. 산출물 로드 (점진적 공개)

각 산출물에서 필요한 최소한의 컨텍스트만 로드합니다:

**spec.md에서:**
- 개요/컨텍스트
- 기능 요구 사항
- 비기능 요구 사항
- 사용자 스토리
- 예외 케이스 (있는 경우)

**plan.md에서:**
- 아키텍처/스택 선택
- 데이터 모델 참조
- 단계(Phases)
- 기술적 제약 사항

**tasks.md에서:**
- 작업 ID
- 설명
- 단계 그룹화
- 병렬 마커 [P]
- 참조된 파일 경로

**헌법에서:**
- 원칙 검증을 위해 `.specify/memory/constitution.md` 로드

### 3. 시맨틱 모델 구축

내부 표현을 생성합니다 (출력에 원본 산출물을 포함하지 마십시오):
- **요구 사항 인벤토리**: 고유 키가 있는 각 기능 및 비기능 요구 사항 (명령형 문구를 기반으로 슬러그 도출; 예: "사용자가 파일을 업로드할 수 있음" → `user-can-upload-file`)
- **사용자 스토리/액션 인벤토리**: 수락 기준이 있는 개별 사용자 액션
- **작업 커버리지 매핑**: 각 작업을 하나 이상의 요구 사항 또는 스토리에 매핑 (키워드 또는 ID/키 문구와 같은 명시적 참조 패턴으로 추론)
- **헌법 규칙 세트**: 원칙 이름 및 MUST/SHOULD 규범적 진술 추출

### 4. 탐지 패스 (토큰 효율적 분석)

신호가 강한 발견 사항에 집중합니다. 총 50개로 제한하고 나머지는 초과 요약에 합산합니다.

#### A. 중복 탐지
- 유사한 요구 사항 식별
- 통합을 위해 품질이 낮은 문구 표시

#### B. 모호성 탐지
- 측정 가능한 기준이 없는 모호한 형용사(빠른, 확장 가능한, 안전한, 직관적인, 견고한) 플래그 지정
- 해결되지 않은 자리 표시자(TODO, TKTK, ???, `<placeholder>` 등) 플래그 지정

#### C. 사양 미비
- 동사는 있지만 목적어나 측정 가능한 결과가 없는 요구 사항
- 수락 기준 정렬이 누락된 사용자 스토리
- 사양/계획에 정의되지 않은 파일이나 컴포넌트를 참조하는 작업

#### D. 헌법 정렬
- MUST 원칙과 충돌하는 요구 사항 또는 계획 요소
- 헌법에서 규정한 섹션 또는 품질 게이트 누락

#### E. 커버리지 공백
- 연결된 작업이 없는 요구 사항
- 매핑된 요구 사항/스토리가 없는 작업
- 작업에 반영되지 않은 비기능 요구 사항 (예: 성능, 보안)

#### F. 불일치
- 용어 드리프트 (파일 간에 동일한 개념이 다르게 명명됨)
- 계획에는 참조되지만 사양에는 없는 데이터 엔티티 (또는 그 반대)
- 작업 순서 모순 (예: 의존성 참고 없이 기반 설정 작업보다 먼저 있는 통합 작업)
- 충돌하는 요구 사항 (예: 하나는 Next.js를 요구하고 다른 하나는 Vue를 명시함)

### 5. 심각도 할당

다음 휴리스틱을 사용하여 발견 사항의 우선순위를 정합니다:
- **심각(CRITICAL)**: 헌법의 MUST 위반, 핵심 사양 산출물 누락, 또는 기본 기능을 차단하는 커버리지 제로 요구 사항
- **높음(HIGH)**: 중복되거나 충돌하는 요구 사항, 모호한 보안/성능 속성, 테스트 불가능한 수락 기준
- **중간(MEDIUM)**: 용어 드리프트, 누락된 비기능 작업 커버리지, 미비한 예외 케이스
- **낮음(LOW)**: 스타일/문구 개선, 실행 순서에 영향을 주지 않는 경미한 중복

### 6. 요약 분석 보고서 생성

다음 구조로 마크다운 보고서를 출력하십시오 (파일 쓰기 없음):

## 사양 분석 보고서

| ID | 카테고리 | 심각도 | 위치 | 요약 | 권장 조치 |
|----|----------|--------|------|------|-----------|
| A1 | 중복 | 높음 | spec.md:L120-134 | 두 개의 유사한 요구 사항... | 문구 통합; 더 명확한 버전 유지 |

(발견 사항당 한 줄씩 추가; 카테고리 이니셜이 접두사로 붙은 고정 ID 생성)

**커버리지 요약 표:**

| 요구 사항 키 | 작업 있음? | 작업 ID | 참고 |
|--------------|------------|---------|------|

**헌법 정렬 문제:** (있는 경우)

**매핑되지 않은 작업:** (있는 경우)

**지표:**
- 총 요구 사항 수
- 총 작업 수
- 커버리지 % (작업이 1개 이상인 요구 사항)
- 모호성 수
- 중복 수
- 심각한 이슈 수

### 7. 다음 단계 안내

보고서 끝에 간결한 '다음 단계' 블록을 출력하십시오:
- 심각(CRITICAL) 이슈가 있는 경우: `/speckit.implement` 전에 해결할 것을 권장
- 낮음/중간 이슈만 있는 경우: 진행할 수 있으나 개선 제안 제공
- 명시적인 명령 제안: 예: "개선 사항과 함께 /speckit.specify 실행", "아키텍처 조정을 위해 /speckit.plan 실행", "'performance-metrics' 커버리지 추가를 위해 tasks.md 수동 편집"

### 8. 개선 제안

사용자에게 묻습니다: "상위 N개 이슈에 대해 구체적인 개선 편집안을 제안해 드릴까요?" (자동으로 적용하지 마십시오.)

## 운영 원칙

### 컨텍스트 효율성
- **최소한의 고신호 토큰**: 포괄적인 문서화가 아닌 실행 가능한 발견 사항에 집중
- **점진적 공개**: 산출물을 점진적으로 로드하고 분석에 모든 내용을 쏟아붓지 마십시오.
- **토큰 효율적 출력**: 발견 사항 표를 50행으로 제한하고 초과분은 요약하십시오.
- **결정론적 결과**: 변경 없이 다시 실행하면 일관된 ID와 카운트가 생성되어야 합니다.

### 분석 가이드라인
- **파일을 절대 수정하지 마십시오** (이것은 읽기 전용 분석입니다).
- **누락된 섹션을 절대 환각(hallucinate)하지 마십시오** (없는 경우 정확하게 보고하십시오).
- **헌법 위반을 우선시하십시오** (이는 항상 심각(CRITICAL) 단계입니다).
- **포괄적인 규칙보다 예시를 사용하십시오** (일반적인 패턴이 아닌 구체적인 사례를 인용하십시오).
- **이슈가 없는 경우에도 우아하게 보고하십시오** (커버리지 통계와 함께 성공 보고서를 출력하십시오).

## 컨텍스트

{{args}}
"""
